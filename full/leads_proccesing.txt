
function engine_leads_processing_test() {

//Перезвон
var str = "привет";
Logger.log(str.indexOf("привет".toLowerCase()))
}

engine_leads_processing = {}

engine_leads_processing.bad_approve_status = ['отправить позже', 'отмен', 'предоплаты', '4+ дней', '4 день', '3 день', '2 день', '1 день', 'перезвон']
engine_leads_processing.good_approve_status_group = ['accepted', 'shipped', 'paid', 'return']

engine_leads_processing.is_fake_approve = function(lead) {

  if (typeof(lead.status_verbose) == 'undefined')
    throw "Can't find lead.status_verbose"
  if (typeof(lead.status_group) == 'undefined')
    throw "Can't find lead.status_group"    
  if (typeof(lead.approved_at) == 'undefined')
    throw "Can't find lead.approved_at"
  if (typeof(lead.canceled_at) == 'undefined')
    throw "Can't find lead.canceled_at"

  if (engine_leads_processing.good_approve_status_group.indexOf(lead.status_group) < 0)
    return "Группа статусов: " + lead.status_group;


  var status_verbose = lead.status_verbose.toLowerCase();
  if (status_verbose.indexOf('отправить позже') > -1)
    return "Заказ в статусе 'Отправить позже'";

  if (lead.approved_at <= lead.canceled_at && 
    (lead.canceled_at != '' || lead.canceled_at == null) && 
    (lead.approved_at != '' || lead.approved_at != null))
    return "Заказ отменён (" + lead.canceled_at + ") после подтверждения (" + lead.approved_at + ")";

  if (lead.approved_at == '' || lead.approved_at == null)
    return "Отсутствует дата подтверждения"

  for (var i in engine_leads_processing.bad_approve_status)
    if (status_verbose.indexOf(engine_leads_processing.bad_approve_status[i]) >= 0)
      return "Заказ в статусе: " + status_verbose;

  return "";
} 

engine_leads_processing.is_fake_buyout = function(lead) {
  if (typeof(lead.status_group) == 'undefined')
    throw "Can't find lead.status_group"
  if (typeof(lead.buyout_at) == 'undefined')
    throw "Can't find lead.buyout_at"
/*
  if (typeof(lead.is_approved) == 'undefined')
    throw "Can't find lead.is_approved"

  if (lead.is_approved == false)
    return "Лид не подтвержден"
*/  
  if (lead.status_group != 'paid')
    return "Лид не в группе статусов paid"
  if (lead.buyout_at == "" || lead.buyout_at == null)
    return "Отсутствует дата выкупа"
  
  return ""
}

engine_leads_processing.is_processing = function(lead) {
  if (typeof(lead.status_group) == 'undefined')
    throw "Can't find lead.status_group"  
  if (lead.status_group == 'processing')
    return "";
  return "Лид не в группе статусов processing";
}